
<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <h1>Analyzing Different Arm Injuries over the Course of a Baseball Season</h1>
  <h3> Below is a breakdown of the trends of different types of arm injuries with respect to each month for the entire 2024 MLB season.<br><br><br></h3>
  <ul>
    <a href="index.html"
    style="position:absolute; 
    text-decoration:none;
    left:250px; top:120px; 
    font-weight:bold;
    background-color: #eee;
    border-radius:5px;
    color: black;
    border: 2px solid black;   
    font-size:30px;" >&nbsp;&#8592;Back&nbsp;</a>
    <a href="slide1.html"
    style="position:absolute; 
    text-decoration:none;
    left:400px; top:120px; 
    font-weight:bold;
    background-color: #eee;
    border-radius:5px;
    color: black;
    border: 2px solid black;  
    font-size:30px;">&nbsp;Next&#8594;&nbsp;</a>
  </ul>



<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/d3-svg-annotation@2.5.1/d3-annotation.min.js"></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=800 height=600>
</svg>
<script>


async function init() {
  var height = 550, width = 550;
  var margin = 50;

  const num_months = 9;
  const injuryType = ["elbow", "forearm", "shoulder", "total"];
  const allData = await d3.csv('https://jackrwarren.github.io/injuries.csv');
  const color = d3.scaleOrdinal(d3.schemeCategory10);
  var countData = {};

  allData.forEach(d => {
      var type = String(d.injuryType);
      var month = Number(d.injuryMonth);
      if (type === "TJ") type = "elbow";
      if (!countData[type]) countData[type] = {};
      if (!countData["total"]) countData["total"] = {};
      if (!countData[type][month]) countData[type][month] = 0;
      if (!countData["total"][month]) countData["total"][month] = 0;
      countData["total"][month] ++;
      countData[type][month]++;
  })


  const data = Object.entries(countData).map(([type, monthMap]) => {
      const values = Array.from({ length: num_months }, (d, i) => {
        const month = i + 1;
        return {
          month,
          count: monthMap[month] || 0
        };
      });
      return { type, values };
    });


  var xScale = d3.scaleLinear().domain([1,9]).range([0, width]);
  var yScale = d3.scaleLinear().domain([0, 50]).range([height, 0]);
  const svg = d3.select('svg').attr("width", width + 4*margin).attr("height", height + 2*margin).append('g').attr('transform', "translate("+margin+","+margin+")");
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep"];

  // HIGHLIGHTED MONTHS
  let startMonth = 0, endMonth = 3;

  svg.append("rect")
    .attr("x", xScale(startMonth+1))             
    .attr("y", -1 * 40)                      
    .attr("width", xScale(endMonth) - xScale(startMonth+1))
    .attr("height", height + 40)     
    .attr("fill", "lightgray")
    .attr("opacity", 0.3);

  data.forEach((s, i) => {
      var highlightColor = d3.color(color(s.type));
      var highlightColorDates = s.values.filter(d => (startMonth <= d.month && d.month <= endMonth));
      var lightColorDates = s.values.filter(d => ((d.month <= startMonth) || (d.month >= endMonth)));
      var line = d3.line().x(d => xScale(d.month)).y(d => yScale(d.count));

      svg.append("path")
        .datum(highlightColorDates)
        .attr("fill", "none")
        .attr("stroke", highlightColor)
        .attr("stroke-width", 6)
        .attr("d", line);

      svg.append("path")
        .datum(lightColorDates)
        .attr("fill", "none")
        .attr("stroke", highlightColor.brighter(1))
        .attr("stroke-width", .5)
        .attr("stroke-dasharray", "4 2")
        .attr("d", line);

      var curr_points = svg.selectAll(`${s.key}`)
        .data(highlightColorDates)
        .enter().append("circle")
        .attr("class", `${s.key}`)
        .attr("cx", d => xScale(d.month))
        .attr("cy", d => yScale(d.count))
        .attr("r", 6)
        .attr("fill", highlightColor.formatRgb());
      
    });

  svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(num_months).tickFormat(d => months[d-1]));
  svg.append("g").call(d3.axisLeft(yScale).ticks(5).tickFormat(d3.format("~s")));

  const legend = svg.append("g")
    .attr("transform", "translate(" + (width + 25) + ", 0)"); 

  data.forEach((s, i) => {
    let curr_legend = legend.append("g")
      .attr("transform", `translate(0, ${i * 20})`);

    curr_legend.append("rect")
      .attr("width", 8)
      .attr("height", 8)
      .attr("fill", color(s.type));

    curr_legend.append("text")
      .attr("x", 10)
      .attr("y", 7)
      .text(s.type + ' injuries')
      .style("font-size", "12px")
  });

  svg.append("text")
    .attr("x", width / 2)
    .attr("y", height + 40)
    .attr("text-anchor", "middle")
    .style("font-size", "14px")
    .text("Month");

  svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -1 * height / 2)
    .attr("y", -40)
    .attr("text-anchor", "middle")
    .style("font-size", "14px")
    .text("Injury Count");


  // TEXT
  svg.append("text")
    .attr("x", 15)
    .attr("y", -10)
    .text("Preseason")
    .style("font-size", "18px")
    .style("font-weight", "bold");

  // LABELS

  const type = d3.annotationLabel;
  const annotations = [
  {
    note: {
      label: "The number of total injuries ramps up towards the start of the season, often due to the sudden increase in workload. As the regular season approaches, more and more throwing is done leading to higher chances of injury.",
      bgPadding: 20,
      title: "Total Injuries",
      wrap: 200
    },
    data: {x: xScale(2.5), y: yScale(20)},
    className: "show-bg",
    dx: 60,
    dy: -150,
  },
  {
    note: {
      label: "The spike in shoulder injuries in Feb can be explained by the exposure of shoulder-specific muscles (like the rotator cuff) in arm strength exercises done in early Spring Training to build conditioning and stamina.",
      bgPadding: 20,
      title: "Shoulder Injuries",
      wrap: 200
    },
    data: {x: xScale(2), y: yScale(12)},
    className: "show-bg",
    dx: 299,
    dy: -20
  }

  ];

  const makeAnnotations = d3.annotation()
    .type(type)
    .accessors({x: d=> d.x, y: d=> d.y})
    .annotations(annotations);

  svg.append("g").attr("class", "annotation-group").call(makeAnnotations);

  svg.selectAll(".annotation-note-title")
    .style("fill", "black");

  svg.selectAll(".annotation-note-label")
    .style("fill", "black");

  svg.selectAll(".annotation-connector path")
    .style("stroke-width", "3px")
    .style("fill", "black");

}
</script>
</body>
</html>